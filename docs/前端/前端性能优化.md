# 前端性能优化

---------------------------

## 一、减少HTTP请求次数和请求的大小

----------------------

### 1. 文件合并与压缩

#### 1.1 雪碧图(css sprite)合并小图片

> 使用[TexturePacker](https://www.codeandweb.com/texturepacker)工具将进行合并，
>
> 通过`background-position`来设置图片的起始点，配合`width.height`来获取需要的图片

+ 优点
  + 将大量图片请求合并成一个
+ 缺点
  + 难以操作和更新，每次更新都要对所有图片进行重新引入
  + 如果合成的图片过于紧凑，可能使用一个图片元素会显示另一个图片元素的内容

#### 1.2 将css/js/图片等文件进行合并压缩

 + 合并

   > 尽可能只引入`一个css`与`一个js`文件.可使用`webpack`工具进行打包合并

 + 压缩

   > 将要引入的文件进行压缩处理
   >
   > 图片可使用 **[tinypng](http://tinypng.com)** 等工具进行压缩
   >
   > 对整个项目可使用`gzip`方案进行加载速度优化

### 2. 使用新的文件格式代替传统格式

#### 2.1 使用 字体图标([iconfont](https://www.iconfont.cn/manage/index?spm=a313x.7781069.1998910419.11&manage_type=myprojects&projectId=-1))或svg 等矢量图替换 png/jpg

> `webp`格式需要服务器端支持，尽量使用
>
> 基于代码渲染，相对使用位图需要将图片编码再渲染更快

+ svg优点
  + 基于计算，没有像素点，不会失真变形
+ iconfont优点
  +  使用字体文件代替图片文件，加载体积小
  + 可以通过`font-size``color`改变图标的颜色和大小
  + 支持 css3 对文件添加诸如 `阴影`、`旋转`、`透明度`等效果

#### 2.2 使用JSON格式进行数据传输

> 也可以使用二进制编码或者文件流的格式进行传输

`JSON`现对于`XML`格式来说更小一些

#### 2.3 使用base64

> 对于原始图片，可以在使用`webpack`进行打包时，转成base64

+ 优点
  + 使用base64代替图片，可以减少http请求，加快浏览器渲染速度
  + 在移动端，能有效的优化图片加载慢的问题
+ 缺点
  + 在页面中嵌入`base64`，会让代码变得不易维护，通过`webpack`将图片编译成base64，可以较好解决这个问题
  + 对于资源较大的图片时，转换成base64会导致`js文件`巨大，此时只是将加载图片的压力转嫁到加载`js文件`上，并不能有效解决问题

### 3. 延迟加载

#### 3.1 图片懒加载

> 第一次加载时不去请求真实的图片，只是使用一张占位图规划位置，提高首次进入页面时的速度
>
> 当页面加载完成后
>
> ​	将用户视野内的图片做真实地址加载，
>
> ​	非视野内的不做加载/做预加载，可减少请求节约流量

```html
<img class="lazy" src="placeholder-image.jpg" data-src="image-to-lazy-load-1x.jpg" data-srcset="image-to-lazy-load-2x.jpg" alt="I'm an image!">
```

> 在`src` 中设置为**占位图**
>
> 在`data-src`中为**真实地址**
>
> 监听该图片进入到视野中时，将`src`中的地址修改为`data-src`中的值。达到懒加载的效果